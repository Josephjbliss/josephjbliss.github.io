$(function() {
  'use strict';
  var vHeight = $(window).height();
  var vWidth = $(window).width();
  var clicking = false;
  var expanded = false;

  $(document).mouseup(function() {
    clicking = false;
    $('#viewport').removeClass('panning');
  });

  var makeURL = function(h, w) {
    return 'https://bonobos-prod-s3.imgix.net/products/18158/original/SHIRT_ShortSleeve_ZebraRun_JetBlack_hero1.jpg?h=' + h + '&w=' + w;
  }

  var makeImage = function(h, w) {
    $('#viewport img').remove();
    $('<img/>').attr('src', makeURL(h, w)).insertBefore('#viewport nav');
    if (expanded) {
      $('#viewport img').addClass('expanded');
    }
  }

  var centerImage = function() {
    if (expanded) {
      $('#viewport').scrollLeft(vWidth);
      $('#viewport').scrollTop(vHeight);
    }
  }

  makeImage(vHeight, vWidth);

  //'Debounce' resize event
  var resizeTimer;
  $(window).on('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      vHeight = $(window).height();
      vWidth = $(window).width();
      makeImage(vHeight, vWidth);
      centerImage();
    }, 100);
  });

  $('#zoomin').on('click', function(evt) {
    evt.preventDefault();
    expanded = true;
    makeImage(vHeight * 3, vWidth * 3);
    centerImage();
  });

  $('#zoomout').on('click', function(evt) {
    evt.preventDefault();
    expanded = false;
    makeImage(vHeight, vWidth);
    centerImage();
  });

  var previousX;
  var previousY;

  $('#viewport').on('mousedown', function(evt) {
    evt.preventDefault();
    previousX = evt.clientX;
    previousY = evt.clientY;
    clicking = true;
    $(this).addClass('panning');
  });

  $('#viewport').on('mousemove', function(evt) {
    if (clicking) {
      evt.preventDefault();
      var directionX;
      var directionY;
      if ((previousX - evt.clientX) > 0)
        directionX = 1;
      else {
        directionX = -1;
      }      
      if ((previousY - evt.clientY) > 0)
        directionY = 1;
      else {
        directionY = -1;
      }
      // var directionX = (previousX - e.clientX) > 0 ? 1 : -1;
      // var directionY = (previousY - e.clientY) > 0 ? 1 : -1;
      $('#viewport').scrollLeft($('#viewport').scrollLeft() + (previousX - evt.clientX));
      $('#viewport').scrollTop($('#viewport').scrollTop() + (previousY - evt.clientY));
      previousX = evt.clientX;
      previousY = evt.clientY;
    }
  });

  $('#viewport').on('mouseleave', function(evt) {
    clicking = false;
    $(this).removeClass('panning');
  });

});
